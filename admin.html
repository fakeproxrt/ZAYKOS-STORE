<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | ZAYKOS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --text-main: #ffffff;
            --text-label: #94a3b8; /* Ù„ÙˆÙ† ØªÙˆØ¶ÙŠØ­ÙŠ ÙØ§ØªØ­ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --input-bg: #334155;
            --border-color: #475569;
        }

        body.light-mode {
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-label: #475569; /* Ù„ÙˆÙ† ØºØ§Ù…Ù‚ ÙˆÙˆØ§Ø¶Ø­ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
            --input-bg: #ffffff;
            --border-color: #cbd5e1;
        }

        body { background: var(--bg-body); color: var(--text-main); font-family: 'Tajawal', sans-serif; transition: 0.3s; }
        .admin-card { background: var(--bg-card); border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); color: var(--text-main); }
        
        /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„Ù„ÙŠØ¨Ù„ (Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙˆÙ‚ Ø§Ù„Ø­Ù‚ÙˆÙ„) */
        label { 
            color: var(--text-label) !important; 
            font-weight: 700; 
            margin-bottom: 8px; 
            display: block;
            font-size: 0.9rem;
        }

        #login-overlay { position: fixed; inset: 0; background: #0f172a; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .form-control, .form-select { 
            background: var(--input-bg) !important; 
            border: 2px solid var(--border-color) !important; 
            color: var(--text-main) !important; 
            padding: 12px;
            border-radius: 12px;
        }
        .form-control:focus { border-color: #3b82f6 !important; box-shadow: none; }
        
        .table { color: var(--text-main) !important; }
        .btn-primary { background: #3b82f6; border: none; padding: 12px; border-radius: 12px; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="text-center p-4 bg-dark rounded-4 shadow" style="width: 350px;">
        <h4 class="mb-4 text-white">ğŸ” Ø¯Ø®ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© ZAYKOS</h4>
        <input type="password" id="admin-pass" class="form-control mb-3 text-center" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn btn-primary w-100" onclick="checkAuth()">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div class="container py-5" id="main-content" style="display:none;">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h2 class="fw-bold">âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ZAYKOS</h2>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-warning btn-sm fw-bold" onclick="toggleTheme()">ğŸŒ“ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹</button>
            <button class="btn btn-outline-danger btn-sm fw-bold" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="admin-card p-4">
                <h5 class="text-info mb-4 fw-bold">â• Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯</h5>
                
                <div class="mb-3">
                    <label>Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</label>
                    <select id="platform" class="form-select">
                        <option value="tele">ØªÙ„ÙŠØ¬Ø±Ø§Ù… ğŸ”¹</option>
                        <option value="wa">ÙˆØ§ØªØ³Ø§Ø¨ ğŸŸ¢</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ø¹Ù…Ù„Ø©</label>
                    <input type="text" id="country" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ù…ØµØ± ğŸ‡ªğŸ‡¬">
                </div>

                <div class="row">
                    <div class="col-6 mb-3">
                        <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
                        <input type="number" id="price" class="form-control" placeholder="0.00">
                    </div>
                    <div class="col-6 mb-3">
                        <label>Ø³Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="number" id="discount" class="form-control" placeholder="0.00">
                    </div>
                </div>

                <button class="btn btn-primary w-100 mt-2 fw-bold" onclick="addItem()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¢Ù† ğŸš€</button>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="admin-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="text-warning fw-bold">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</h5>
                    <button class="btn btn-sm btn-danger px-3" onclick="deleteAll()">ØªØµÙÙŠØ± Ø§Ù„Ù…Ø®Ø²Ù†</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--border-color)">
                                <th>Ø§Ù„Ø¯ÙˆÙ„Ø©</th>
                                <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                            </tr>
                        </thead>
                        <tbody id="admin-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const SUPABASE_URL = "https://vjwmoejvkauscrkdspis.supabase.co";
    const SUPABASE_KEY = "sb_publishable_ZuXdVnkD745wHOVlbloWEw__T7VIRn8";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function checkAuth() {
        if(document.getElementById('admin-pass').value === "1234") {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            fetchAdminData();
        } else {
            Swal.fire('Ø®Ø·Ø£', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
        }
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
    }

    async function fetchAdminData() {
        const { data, error } = await supabaseClient.from('numbers_store').select('*').order('created_at', { ascending: false });
        const list = document.getElementById('admin-list');
        list.innerHTML = "";
        
        if(data) {
            data.forEach(item => {
                list.innerHTML += `
                    <tr>
                        <td class="fw-bold">${item.country} <br> <small class="text-info">${item.platform === 'tele' ? 'ØªÙ„ÙŠØ¬Ø±Ø§Ù…' : 'ÙˆØ§ØªØ³Ø§Ø¨'}</small></td>
                        <td class="fw-bold text-success">${item.discount_price ? item.discount_price : item.price}$</td>
                        <td>
                            <button onclick="toggleAvail(${item.id}, ${item.is_available})" class="btn btn-sm ${item.is_available ? 'btn-success' : 'btn-secondary'} rounded-pill px-3">
                                ${item.is_available ? 'Ù…ØªÙˆÙØ±' : 'Ù…Ù†ØªÙ‡ÙŠ'}
                            </button>
                        </td>
                        <td>
                            <button onclick="deleteItem(${item.id})" class="btn btn-outline-danger btn-sm border-0">ğŸ—‘ Ø­Ø°Ù</button>
                        </td>
                    </tr>
                `;
            });
        }
    }

    async function addItem() {
        const country = document.getElementById('country').value;
        const price = document.getElementById('price').value;
        if(!country || !price) {
            Swal.fire('Ù†Ø§Ù‚Øµ!', 'Ø¹Ø¨ÙŠ Ø§Ù„Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ø³Ø¹Ø± Ø£ÙˆÙ„Ø§Ù‹', 'warning');
            return;
        }

        const payload = {
            platform: document.getElementById('platform').value,
            country: country,
            price: parseFloat(price),
            discount_price: document.getElementById('discount').value ? parseFloat(document.getElementById('discount').value) : null,
            is_available: true
        };

        const { error } = await supabaseClient.from('numbers_store').insert([payload]);
        if(!error) {
            Swal.fire('Ù…Ù…ØªØ§Ø²!', 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù‚Ù… Ù„Ù€ ZAYKOS', 'success');
            document.getElementById('country').value = "";
            document.getElementById('price').value = "";
            document.getElementById('discount').value = "";
            fetchAdminData();
        }
    }

    async function deleteItem(id) {
        const result = await Swal.fire({ title: 'Ø­Ø°Ù Ø§Ù„Ø±Ù‚Ù…ØŸ', icon: 'warning', showCancelButton: true, confirmButtonText: 'Ø§Ø­Ø°Ù' });
        if(result.isConfirmed) {
            await supabaseClient.from('numbers_store').delete().eq('id', id);
            fetchAdminData();
        }
    }

    async function toggleAvail(id, status) {
        await supabaseClient.from('numbers_store').update({ is_available: !status }).eq('id', id);
        fetchAdminData();
    }

    async function deleteAll() {
        const result = await Swal.fire({ title: 'ØªØµÙÙŠØ± ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…ØŸ', text: "Ù…Ø§ ØªÙ‚Ø¯Ø± ØªØ±Ø¬Ø¹Ù‡Ù… Ø¨Ø¹Ø¯ÙŠÙ†!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33' });
        if(result.isConfirmed) {
            await supabaseClient.from('numbers_store').delete().neq('id', 0);
            fetchAdminData();
        }
    }
</script>
</body>
</html>
